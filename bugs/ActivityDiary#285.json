{
    "apk_name": "ActivityDiary_v1.4.0.apk",
    "url": "https://github.com/ramack/ActivityDiary/issues/285",
    "repo": "ActivityDiary",
    "title": "``NumberFormatException`` and can never open the setting page anymore",
    "body": "This exception was found on the master (v1.4.0, the latest code version) and a Google Android phone. \r\n\r\nSTR:  Go to setting, click ``Location Service``, choose ``Network``, open ``Update period``, delete the default value \"5\" (leave the EditText empty), and click ``OK``.\r\n\r\nThe exception trace:\r\n\r\n```\r\njava.lang.NumberFormatException: Invalid int: \"\"\r\n \tat java.lang.Integer.invalidInt(Integer.java:138)\r\n \tat java.lang.Integer.parseInt(Integer.java:358)\r\n \tat java.lang.Integer.parseInt(Integer.java:334)\r\n \tat de.rampro.activitydiary.ui.settings.SettingsActivity.updateLocationAge(SettingsActivity.java:238)\r\n \tat de.rampro.activitydiary.ui.settings.SettingsActivity.onSharedPreferenceChanged(SettingsActivity.java:135)\r\n \tat android.app.SharedPreferencesImpl$EditorImpl.notifyListeners(SharedPreferencesImpl.java:479)\r\n \tat android.app.SharedPreferencesImpl$EditorImpl.apply(SharedPreferencesImpl.java:387)\r\n \tat android.support.v7.preference.Preference.tryCommit(Preference.java:1613)\r\n \tat android.support.v7.preference.Preference.persistString(Preference.java:1644)\r\n \tat android.support.v7.preference.EditTextPreference.setText(EditTextPreference.java:69)\r\n \tat android.support.v7.preference.EditTextPreferenceDialogFragmentCompat.onDialogClosed(EditTextPreferenceDialogFragmentCompat.java:96)\r\n \tat android.support.v7.preference.PreferenceDialogFragmentCompat.onDismiss(PreferenceDialogFragmentCompat.java:270)\r\n \tat android.app.Dialog$ListenersHandler.handleMessage(Dialog.java:1323)\r\n \tat android.os.Handler.dispatchMessage(Handler.java:102)\r\n \tat android.os.Looper.loop(Looper.java:148)\r\n \tat android.app.ActivityThread.main(ActivityThread.java:5417)\r\n \tat java.lang.reflect.Method.invoke(Native Method)\r\n \tat com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:726)\r\n \tat com.android.internal.os.ZygoteInit.main(ZygoteInit.java:616)\r\n```\r\n\r\nOnce this issue happens, the ``setting`` page cannot be opened, and the app crashes with the exception trace below.\r\n\r\n```\r\njava.lang.RuntimeException: Unable to start activity ComponentInfo{de.rampro.activitydiary.debug/de.rampro.activitydiary.ui.settings.SettingsActivity}: java.lang.NumberFormatException: Invalid int: \"\"\r\n \tat android.app.ActivityThread.performLaunchActivity(ActivityThread.java:2416)\r\n \tat android.app.ActivityThread.handleLaunchActivity(ActivityThread.java:2476)\r\n \tat android.app.ActivityThread.-wrap11(ActivityThread.java)\r\n \tat android.app.ActivityThread$H.handleMessage(ActivityThread.java:1344)\r\n \tat android.os.Handler.dispatchMessage(Handler.java:102)\r\n \tat android.os.Looper.loop(Looper.java:148)\r\n \tat android.app.ActivityThread.main(ActivityThread.java:5417)\r\n \tat java.lang.reflect.Method.invoke(Native Method)\r\n \tat com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:726)\r\n \tat com.android.internal.os.ZygoteInit.main(ZygoteInit.java:616)\r\n Caused by: java.lang.NumberFormatException: Invalid int: \"\"\r\n \tat java.lang.Integer.invalidInt(Integer.java:138)\r\n \tat java.lang.Integer.parseInt(Integer.java:358)\r\n \tat java.lang.Integer.parseInt(Integer.java:334)\r\n \tat de.rampro.activitydiary.ui.settings.SettingsActivity.updateLocationAge(SettingsActivity.java:238)\r\n \tat de.rampro.activitydiary.ui.settings.SettingsActivity.onCreate(SettingsActivity.java:471)\r\n \tat android.app.Activity.performCreate(Activity.java:6237)\r\n \tat android.app.Instrumentation.callActivityOnCreate(Instrumentation.java:1107)\r\n \tat android.app.ActivityThread.performLaunchActivity(ActivityThread.java:2369)\r\n \t... 9 more\r\n```",
    "comments": [
        "Any plan to fix this issue? I think adding an additional check on the input value would be able to totally fix this issue.",
        "Thanks for reporting. And sorry for.the late answer. Clearly I have to fix this, and it should not be hard to do so. Currently being without computer and long time I did not invest into this app. Again, very sorry. In the last time I focused more on making up my mind on climate change and what.co.sequences it should have on my life than on programming apps.\r\n\r\nBut I'll try to push a new version soon. In case you are willing to contribute I'd happily review a PR!",
        "Thanks for your reply. I understand your situation. I will try to issue a PR. ",
        "Hi @ramack , I inspected the code and located the culprit of this issue:\r\n\r\nhttps://github.com/ramack/ActivityDiary/blob/674fff504d1d856671e2bf9b482d8d0b6238d98d/app/src/main/java/de/rampro/activitydiary/ui/settings/SettingsActivity.java#L238\r\n\r\nThe issue can be quickly fixed by modifying this line to the code below:\r\n\r\n```\r\n        int v;\r\n        try{\r\n            v = Integer.parseInt(value.replaceAll(\"\\\\D\",\"\"));\r\n        }catch (NumberFormatException e){\r\n            return;\r\n        }\r\n```\r\n\r\nBut I am not very faimilar with the app logics. After I manually fixed in this way. It can indeed avoid the crash, but when I reopen the dialog. The invalid input will appear there (instead of showing the default value of ``5``). I am not quite sure how to fix this. Hope my small fix could help you fix this issue in the next version."
    ]
}