{
    "apk_name": "Anki-Android_v2.9alpha.apk",
    "url": "https://github.com/ankidroid/Anki-Android/issues/4977",
    "repo": "Anki-Android",
    "title": "Crash in DeckPicker after CardBrowser on clean install",
    "body": "###### Reproduction Steps\r\n\r\n1. Clean install of current alpha, no decks\r\n2. Not sure if it's important, but click floating menu \"get shared decks\" then just back button immediately (it was in the repro and doesn't take long)\r\n3. Click the hamburger and select Card Browser\r\n4. Click the hamburger again and go to Deck list\r\n\r\n\r\n###### Expected Result\r\n\r\nYou should see the Default deck and no cards\r\n\r\n\r\n###### Actual Result\r\n\r\nCrash\r\n\r\n\r\n###### Debug info\r\n\r\nThis is from that same roboelectric test harness someone throws at our alphas (awesome work, that) \r\n\r\nhttps://play.google.com/apps/publish/?account=5338425030304417978#PreLaunchReportPlace:p=com.ichi2.anki&appid=4973711737547064258&plrtab=CRASH&plrvc=20900135\r\n\r\n09-17 10:13:14.046 1712-3619/system_process I/ActivityManager: START u0 {cmp=com.ichi2.anki/.CardBrowser (has extras)} from uid 10136\r\n09-17 10:13:14.050 16163-16163/com.ichi2.anki D/DeckPicker: onPause()\r\n09-17 10:13:14.055 16163-16163/com.ichi2.anki D/CardBrowser: onCreate()\r\n09-17 10:13:14.067 16163-16168/com.ichi2.anki I/zygote: Do partial code cache collection, code=219KB, data=147KB\r\n09-17 10:13:14.068 16163-16168/com.ichi2.anki I/zygote: After code cache collection, code=219KB, data=147KB\r\n    Increasing code cache capacity to 1024KB\r\n09-17 10:13:14.083 16163-16163/com.ichi2.anki D/AnkiActivity: AnkiActivity.startLoadingCollection()\r\n09-17 10:13:14.084 16163-16163/com.ichi2.anki D/CardBrowser: onCollectionLoaded()\r\n09-17 10:13:14.094 16163-16182/com.ichi2.anki D/DeckTask: doInBackgroundSearchCards\r\n09-17 10:13:14.094 16163-16163/com.ichi2.anki D/CardBrowser: onResume()\r\n09-17 10:13:14.095 16163-16163/com.ichi2.anki D/DialogHandler: Reading persistent message\r\n09-17 10:13:14.115 1428-1428/? D/gralloc_ranchu: gralloc_alloc: Creating ashmem region of size 8298496\r\n09-17 10:13:14.121 1428-1428/? I/chatty: uid=1000(system) allocator@2.0-s identical 1 line\r\n09-17 10:13:14.125 1428-1428/? D/gralloc_ranchu: gralloc_alloc: Creating ashmem region of size 8298496\r\n09-17 10:13:14.155 16163-16168/com.ichi2.anki I/zygote: JIT allocated 56KB for compiled code of void android.view.View.<init>(android.content.Context, android.util.AttributeSet, int, int)\r\n09-17 10:13:14.166 16163-16163/com.ichi2.anki I/CardBrowser: CardBrowser:: Completed doInBackgroundSearchCards Successfuly\r\n09-17 10:13:14.166 16163-16163/com.ichi2.anki D/AndroidRuntime: Shutting down VM\r\n    \r\n    \r\n    --------- beginning of crash\r\n09-17 10:13:14.167 16163-16163/com.ichi2.anki E/AndroidRuntime: FATAL EXCEPTION: main\r\n    Process: com.ichi2.anki, PID: 16163\r\n    java.lang.NullPointerException: Attempt to invoke virtual method 'boolean android.support.v7.widget.SearchView.isIconified()' on a null object reference\r\n        at com.ichi2.anki.CardBrowser$20.onPostExecute(CardBrowser.java:1364)\r\n        at com.ichi2.async.DeckTask$TaskListener.onPostExecute(DeckTask.java:1521)\r\n        at com.ichi2.async.DeckTask.onPostExecute(DeckTask.java:376)\r\n        at com.ichi2.async.DeckTask.onPostExecute(DeckTask.java:69)\r\n        at android.os.AsyncTask.finish(AsyncTask.java:695)\r\n        at android.os.AsyncTask.-wrap1(Unknown Source:0)\r\n        at android.os.AsyncTask$InternalHandler.handleMessage(AsyncTask.java:712)\r\n        at android.os.Handler.dispatchMessage(Handler.java:105)\r\n        at android.os.Looper.loop(Looper.java:164)\r\n        at android.app.ActivityThread.main(ActivityThread.java:6541)\r\n        at java.lang.reflect.Method.invoke(Native Method)\r\n        at com.android.internal.os.Zygote$MethodAndArgsCaller.run(Zygote.java:240)\r\n        at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:767)",
    "comments": [
        "I'll look at this one really quickly, I note it's very late Tokyo-time...",
        "Hmmmm are you sure this is a new bug? It seems to be caused by the decktask not respecting the lifecycle of the card browser, which is probably nothing new.",
        "I'm close to squishing it and I'll check 27.1.1 vs 27.0.2 support libs. I have a hunch ",
        "Also I don't think this is \"high priority\" yet, as I mentioned yesterday, we don't dish that award out so easily unless it's preventing a large number of users from reviewing.",
        "I've got a simple exception-handling spot-fix for it but I'm not happy with my knowledge of the interaction between onCreate() (called first) and onCreateOptionsMenu() (called after) in the whole codebase w.r.t. onCreate expecting onCreateOptionsMenu things to be initialized already, or whether this has been present forever and we just didn't know, or it was #4972 ",
        "does not affect 2.8"
    ]
}